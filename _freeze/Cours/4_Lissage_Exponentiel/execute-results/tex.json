{
  "hash": "a0f7e7455466b9d5846a25c8cb2c0d74",
  "result": {
    "markdown": "---\ntitle: \"4 - Lissage exponentiel\"\n---\n\n\n\n\n### Objectifs de cette séquence\n\nPrésenter les méthodes basiques de prévision d'une série temporelle ainsi que le lissage exponentiel\n\n### Questions de positionnement\n\nQuelles sont les modèles de prévision les plus simples ?\n\nComment évaluer la qualité d'un modèle de prévision ?\n\nQuelles sont les propriétés que doivent suivre les erreurs de prévision ?\n\nQu'est-ce que le lissage exponentiel ?\n\n# Modèles de prévision simples\n\n## Exemples\n\n\n### Comment prévoir ces séries ? (1)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-1-1.pdf)\n:::\n:::\n\n\n### Comment prévoir ces séries ? (2)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-2-1.pdf)\n:::\n:::\n\n\n\n\n### Comment prévoir ces séries ? (3)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-3-1.pdf)\n:::\n:::\n\n\n\n### Modèles de base\n\n1. Moyenne de valeurs passées (`forecast::meanf()` ou `fable::MEAN()`):\n$$\n\\hat y_{t+h|T} = \\bar y = \\frac{1}{T}\\sum_{i=1}^Ty_t\n$$\n\n. . .\n\n2. Dernière valeur connue (`forecast::naive()` ou `fable::NAIVE()`) :\n$$\n\\hat y_{t+h|T} = y_T\n$$\nHypothèse du marché efficient\n\n. . .\n\n3. Dernière valeur connue à la saison précédente (`forecast::snaive()` ou `fable::SNAIVE()`) :\n$$\n\\hat y_{t+h|T} = y_{T+h-m(k+1)}\\quad\\text{avec}\\quad\n\\lfloor (h-1)/m \\rfloor\n$$\n\n. . .\n\nIl y a également d'autres combinaisons possibles (*drift*...), voir https://otexts.com/fpp3/simple-methods.html\n\n### Retour sur les exemples (1)\n\n\\footnotesize\n\n::: {.cell}\n\n```{.r .cell-code}\ny = window(diff(EuStockMarkets[,\"CAC\"]), start = 1998)\nautoplot(y, y = \"Variation dans les prix\",\n\t\t main  = \"Variations quotidiennes du cours\\nde clôture du CAC 40\") +\n  autolayer(meanf(y, h=10), PI=FALSE, series=\"Moyenne\") +\n  autolayer(naive(y, h=10), PI=FALSE, series=\"Naïve\") +\n  guides(colour=guide_legend(title=\"Prévisions\"))\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-4-1.pdf)\n:::\n:::\n\n\n### Retour sur les exemples (2)\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny = window(EuStockMarkets[,\"CAC\"], start = 1998)\nautoplot(y, y = \"Niveau\",\n\t\t main  = \"Cours de clôture du CAC 40\") +\n  autolayer(meanf(y, h=10), PI=FALSE, series=\"Moyenne\") +\n  autolayer(naive(y, h=10), PI=FALSE, series=\"Naïve\") +\n  guides(colour=guide_legend(title=\"Prévisions\"))\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-5-1.pdf)\n:::\n:::\n\n\n\n\n### Retour sur les exemples (3)\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(ldeaths, y = \"NULL\",\n\t\t main  = \"Nombre de décès de maladies pulmonaires au Royaume-Uni\") +\n  autolayer(meanf(ldeaths, h=10), PI=FALSE, series=\"Moyenne\") +\n  autolayer(naive(ldeaths, h=10), PI=FALSE, series=\"Naïve\") +\n  autolayer(snaive(ldeaths, h=10), PI=FALSE, series=\"Seasonal naïve\") +\n  guides(colour=guide_legend(title=\"Prévisions\"))\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-6-1.pdf)\n:::\n:::\n\n\n\n# Modèles exponentiels\n\n### Modèle exponentiel simple (SES)\n\nMéthode entre prévision naïve et moyenne lorsqu'il n'y a pas de tendance ni de saisonnalité claire \n\n. . . \n\nIdée : un poids décroissant est associée aux valeurs passées\n$$\n\\hat y_{T+1|T} = \\alpha y_t + \\alpha (1-\\alpha)y_{t-1} +\n\\alpha (1-\\alpha)^2y_{t-2} + \\dots\n$$\n\n. . .\n\nPeut s'écrire sous forme espace-état :\n$$\n\\begin{cases}\n\\hat y_{T+h|T}&=l_t \\\\\nl_t&=\\alpha y_t+(1-\\alpha)l_{t-1}\n\\end{cases}\\iff\n\\begin{cases}\ny_t&=l_{t-1}+ \\varepsilon_t \\\\\nl_t&=l_{t-1} +\\alpha \\varepsilon_t\n\\end{cases}\n$$\n$l_t$ représente le niveau de la série. \n\n. . .\n\nParamètres à estimer : $l_0$ et $\\alpha$ par minimisation des erreurs de prévision :\n$$\nSSE = \\sum_{t=1}^Te_t^2=\\sum_{t=1}^T(y_t-\\hat y_{t|t-1})^2\n$$\n\n### Exemple\n\n\\footnotesize\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- ses(y) \nmod2 <- ets(y, model = \"ANN\") # autre option\nautoplot(mod) +\n\tautolayer(fitted(mod)) +\n\tlabs(y = \"Niveau\",\n\t\t title  = \"Cours de clôture du CAC 40\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-7-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nETS(A,N,N) \n\nCall:\n ets(y = y, model = \"ANN\") \n\n  Smoothing parameters:\n    alpha = 0.9999 \n\n  Initial states:\n    l = 2857.9761 \n\n  sigma:  45.4825\n\n     AIC     AICc      BIC \n2161.198 2161.343 2170.587 \n```\n:::\n:::\n\n\n### Exemple 2 \n\n\\footnotesize\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- ses(aggregate(co2), h = 12) \nautoplot(mod) +\n\tautolayer(fitted(mod)) +\n\tlabs(y = \"ppm\",\n\t\t title  = \"Concentration atmosphérique annuelle en CO2 à Mauna Loa\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-9-1.pdf)\n:::\n:::\n\n\n### Lissage exponentiel double : Holt (1957)\n\nLe SES peut être étendu pour ajouter une prévision de la tendance :\n\n$$\n\\begin{cases}\n\\hat y_{T+h|T}&=l_t + hb_t \\\\\nl_t&=\\alpha y_t+(1-\\alpha)(l_{t-1}+b_{t-1})\\\\\nb_t&=\\beta^*(l_t-l_{t-1})+(1-\\beta^*)b_{t-1}\n\\end{cases}\\iff\n\\begin{cases}\ny_t&=l_{t-1} + b_{t-1} +\\varepsilon_t\\\\\nl_t&=l_{t-1}+b_{t-1}+\\alpha \\varepsilon_t\\\\\nb_t&=b_{t-1}+\\beta\\varepsilon_t\n\\end{cases}\n$$\n\n. . .\n\nOn a encore $l_t= \\alpha y_t + (1-\\alpha)\\hat y_{t|t-1}.$\n\n\n### *Damped trend*/tendance amortie : Gardner & McKenzie (1985)\n\nLa méthode de Holt prévoit une tendance croissante de manière indéfinie : tend à sur-estimer les prévisions sur horizon longue.\n\n\\bclampe Amortir la tendance avec le temps\n\n$$\n\\begin{cases}\n\\hat y_{T+h|T}&=l_t + (\\phi+\\phi^2+\\dots+\\phi^h)b_t \\\\\nl_t&=\\alpha y_t+(1-\\alpha)(l_{t-1}+\\phi b_{t-1})\\\\\nb_t&=\\beta^*(l_t-l_{t-1})+(1-\\beta^*)\\phi b_{t-1}\n\\end{cases}\\iff\n\\begin{cases}\ny_t&=l_{t-1} + \\phi b_{t-1} +\\varepsilon_t\\\\\nl_t&=l_{t-1}+\\phi b_{t-1}+\\alpha \\varepsilon_t\\\\\nb_t&=\\phi b_{t-1}+\\beta\\varepsilon_t\n\\end{cases}\n$$\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- holt(aggregate(co2), h = 12) \nmod_damped <- holt(aggregate(co2), damped = TRUE, h = 12) \nmod2 <- ets(aggregate(co2), model = \"AAN\") # autre option\nautoplot(aggregate(co2)) + autolayer(mod, PI = FALSE, series = \"Holt\") +\n\tautolayer(mod_damped, PI = FALSE, series = \"Holt Damped trend\") + \n\tautolayer(fitted(mod), series = \"Fitted\") +\n\tlabs(y = \"ppm\",\n\t\t title  = \"Concentration atmosphérique annuelle en CO2 à Mauna Loa\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-10-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nETS(A,A,N) \n\nCall:\n ets(y = aggregate(co2), model = \"AAN\") \n\n  Smoothing parameters:\n    alpha = 0.9999 \n    beta  = 0.1785 \n\n  Initial states:\n    l = 3779.61 \n    b = 10.2955 \n\n  sigma:  5.8373\n\n     AIC     AICc      BIC \n286.2718 288.0900 294.5896 \n```\n:::\n:::\n\n\n### Exemple 2 \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- holt(co2, h = 12) \nmod_damped <- holt(co2, damped = TRUE, h = 12) \nautoplot(co2) + autolayer(mod, PI = FALSE, series = \"Holt\") +\n\tautolayer(mod_damped, PI = FALSE, series = \"Holt Damped trend\") + \n\tautolayer(fitted(mod), series = \"Fitted\") +\n\tlabs(y = \"ppm\",\n\t\t title  = \"Concentration atmosphérique annuelle en CO2 à Mauna Loa\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-12-1.pdf)\n:::\n:::\n\n\n### Holt-Winter\n\nOn ajoute une composante saisonnière !\n\n\\footnotesize\n$$\n\\begin{cases}\n\\hat y_{T+h|T}&=l_t + hb_t  +s_{t+h-m(k+1)}\\\\\nl_t&=\\alpha (y_t-s_{t-m})+(1-\\alpha)(l_{t-1}+b_{t-1})\\\\\nb_t&=\\beta^*(l_t-l_{t-1})+(1-\\beta^*)b_{t-1} \\\\\ns_t &= \\gamma (y_t - l_{t-1} - b_{t-1}) + (1-\\gamma) s_{t-m}\n\\end{cases}\\iff\n\\begin{cases}\ny_t&=l_{t-1} + b_{t-1} +s_{t-m}+\\varepsilon_t\\\\\nl_t&=l_{t-1}+b_{t-1}+\\alpha \\varepsilon_t\\\\\nb_t&=b_{t-1}+\\beta\\varepsilon_t \\\\\ns_t&=s_{t-m}+\\gamma\\varepsilon_t\n\\end{cases}\n$$\n\\normalsize\n\n. . .\n\nOn peut aussi réécrire \n$$\ns_t=\\gamma^*(y_t-l_t)+(1-\\gamma^*)s_{t-m}\n$$\n\n. . .\n\nMême idée avec tendance amortie\n\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- hw(co2, h=12) \nmod2 <- ets(co2, model = \"AAA\") # autre option\nautoplot(co2) + autolayer(mod, PI = FALSE, series = \"Holt-Winter\") +\n\tautolayer(fitted(mod), series = \"Fitted\") +\n\tlabs(y = \"ppm\",\n\t\t title  = \"Concentration atmosphérique mensuelle en CO2 à Mauna Loa\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-13-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nETS(A,A,A) \n\nCall:\n ets(y = co2, model = \"AAA\") \n\n  Smoothing parameters:\n    alpha = 0.5785 \n    beta  = 0.0061 \n    gamma = 0.1373 \n\n  Initial states:\n    l = 315.3303 \n    b = 0.0801 \n    s = -0.8174 -1.836 -3.024 -2.7715 -1.2671 0.7784\n           2.1746 2.702 2.1571 1.1912 0.6693 0.0433\n\n  sigma:  0.294\n\n     AIC     AICc      BIC \n1749.350 1750.710 1819.874 \n```\n:::\n:::\n\n\n### Et maintenant ?\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- hw(AirPassengers, h=12) \nmod2 <- ets(AirPassengers, model = \"AAA\") # autre option\nautoplot(AirPassengers) + autolayer(mod, PI = FALSE, series = \"Holt-Winter\") +\n\tautolayer(fitted(mod), series = \"Fitted\") +\n\tlabs(y = \"Nombre\",\n\t\t title  = \"Passagers aériens\")\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-15-1.pdf)\n:::\n:::\n\n\n\n\n### Saisonnalité multiplicative\n\n\\begin{align*}\n&\\begin{cases}\n\\hat y_{T+h|T}&= (l_t + hb_t)+s_{t+h-m(k+1)}\\\\\nl_t&=\\alpha \\frac{y_t}{s_{t-m}}+(1-\\alpha)(l_{t-1}+b_{t-1})\\\\\nb_t&=\\beta^*(l_t-l_{t-1})+(1-\\beta^*)b_{t-1} \\\\\ns_t &= \\gamma \\frac{y_t}{l_{t-1} + b_{t-1}} + (1-\\gamma) s_{t-m}\n\\end{cases}\\\\\n&\\iff\\begin{cases}\ny_t&=(l_{t-1} + b_{t-1})s_{t-m}+\\varepsilon_t\\\\\nl_t&=l_{t-1}+b_{t-1}+\\alpha \\varepsilon_t\\\\\nb_t&=b_{t-1}+\\beta\\varepsilon_t/s_{t-m} \\\\\ns_t&=s_{t-m}+\\gamma\\varepsilon_t/(l_{t-1}+b_{t-1})\n\\end{cases}\n\\end{align*}\n\n. . .\n\nL'erreur aussi peut être multiplicative !\n\n### Taxonomie des modèles ETS\n\n\\begin{tabular}{l@{}p{2.3cm}@{}c@{}l}\n\\alert{Notations Générales}\n    &                                        & ~E T S~           & ~:\\hspace*{0.3cm}\\textbf{E}xponen\\textbf{T}ial \\textbf{S}moothing \\\\ [-0.2cm]\n    & \\hfill{$\\nearrow$\\hspace*{-0.1cm}}     & {$\\uparrow$}      & {\\hspace*{-0.2cm}$\\nwarrow$} \\\\\n    & \\hfill{\\textbf{E}rreur\\hspace*{0.2cm}}  & {\\textbf{T}endance}  & {\\hspace*{0.2cm}\\textbf{S}aisonnalité}\n\\end{tabular}\n\n. . .\n\n- Erreur : Additive (`\"A\"`) ou multiplicative (`\"M\"`)\n\n- Tendance : Sans tendance (`\"N\"`), additive (`\"A\"`), multiplicative (`\"M\"`) ou amortie (`\"Ad\"` ou `\"Md\"`)\n\n- Saisonnalité : Sans saisonnalité (`\"N\"`), additive (`\"A\"`) ou multiplicative (`\"M\"`)\n\n`\"Z\"` pour une sélection automatique\n\n### Erreurs additives\n\n\\footnotesize\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](img/ets_add.pdf){width=100%}\n:::\n:::\n\n\n*Source : Hyndman, R.J., & Athanasopoulos, G. (2018)*\n\n### Erreurs multiplicatives\n\n\\footnotesize\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](img/ets_multi.pdf){width=100%}\n:::\n:::\n\n\n*Source : Hyndman, R.J., & Athanasopoulos, G. (2018)*\n\n\n### Sous R\n\nPour les objets `ts` : `forecast::ets()` avec paramètre `damped = TRUE` ou `damped = TRUE`.\n\nPour les objets `tsibble` : `fable::ETS()` avec fonctions `error()`, `trend()` et `season()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fable)\nas_tsibble(USAccDeaths) %>%\n  model(ETS(value ~ season(\"A\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A mable: 1 x 1\n  `ETS(value ~ season(\"A\"))`\n                     <model>\n1               <ETS(A,N,A)>\n```\n:::\n:::\n\n\n\n# Résidus et qualité des prévisions\n\n## Analyse des résidus\n\n### Analyse des résidus\n\nOn distingue deux types de prévisions :\n\n- Prévisions *in-sample*, dans l'échantillon, *fitted values* : paramètres estimés sur l'ensemble des données\n\n- Prévisions *out-of-sample*, hors échantillon : on reproduit le processus de prévision $\\hat y_{t+h|t}$ permet de vérifier les problèmes de sur-ajustement\n\n### Prévisions *in-sample*\n\nRésidus : $e_t = y_t - \\hat y_{t}$\n\nHypothèses :\n\n- $(e_t)$ non corrélés (sinon il reste de l'information qui auraient dû être prise en compte dans la prévision)\n\n- $(e_t)$ de moyenne nulle : sinon prévisions biaisées\n\n. . .\n\nHypothèses utiles pour la construction d'intervalles de confiance\n\n- $(e_t)$ ont une variance constante\n\n- $(e_t)$ suivent une loi normale\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(ldeaths, y = \"NULL\",\n\t\t main  = \"Nombre de décès de maladies pulmonaires au Royaume-Uni\",\n\t\t series = \"y\") +\n  autolayer(fitted(snaive(ldeaths)), series = \"Fitted\") \n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-19-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(resid(snaive(ldeaths)), y = \"NULL\",\n\t\t main  = \"Résidus SNAIVE\",\n\t\t series = \"y\") \n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-20-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngghistogram(resid(snaive(ldeaths)), add.normal = TRUE) + \n\tlabs(title = \"Résidus SNAIVE\") \n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-21-1.pdf)\n:::\n:::\n\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggAcf(resid(snaive(ldeaths)), add.normal = TRUE) + \n\tlabs(title = \"Résidus SNAIVE\") \n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-22-1.pdf)\n:::\n:::\n\n\n### ACF et tests Portemanteau (`Box.test()`)\n\nL'ACF est un outils graphique simple pour vérifier ont les mêmes propriétés qu'un bruit blanc. \n\nIl existe également des tests d'autocorrélation :\n\n- Box-Pierce\n$$\nQ = T\\sum_{k=1}^p\\hat\\rho(k)^2\n$$\n\n- Ljung-Box (marche mieux sur petits échantillons)\n$$\nQ^* = T(T+1)\\sum_{k=1}^p(T-k)^{-1}\\hat\\rho(k)^2\n$$\n\nParamètre $p$ à choisir. \nRecommandation : $p=10$ pour séries non saisonnières, $p=2m$ sinon.\n\nSous $(H_0)$ ces quantités suivent $\\chi^2(p-K)$ avec $K$ nb de paramètres dans le modèle\n\n### Exemple\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast::checkresiduals(snaive(ldeaths)) \n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-23-1.pdf)\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLjung-Box test\n\ndata:  Residuals from Seasonal naive method\nQ* = 45.922, df = 14, p-value = 2.887e-05\n\nModel df: 0.   Total lags used: 14\n```\n:::\n:::\n\n\n### Périodogramme cumulatif\n\nOn peut aussi analyser les résidus avec le périodogramme cumulatif : proche d'une ligne droite pour un bruit blanc\n\n\\footnotesize\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,2))\ncpgram(ldeaths)\ncpgram(resid(snaive(ldeaths)))\n```\n\n::: {.cell-output-display}\n![](4_Lissage_Exponentiel_files/figure-beamer/unnamed-chunk-24-1.pdf)\n:::\n:::\n\n\n## Analyse des prévisions\n\n### Mesure de la qualité de la prévisions\n\nPlusieurs critères :\n\\begin{align*}\n&MAE=moy(|e_{T+h}|)\\quad MSE=moy(e_{T+h}^2)\\\\\n&RMSE=\\sqrt{moy(e_{T+h}^2)}\\quad MAPE =100mean(|e_{T+h}|/|y_{T+h}|)\n\\end{align*}\n\nLes 3 premiers critères dépend de l'échelle mais pas le MAPE (mais valable si $y_t\\gg0$)\n\n. . .\n\nMASE proposé par Hyndman and Koehler (IJF, 2006) :\n$$\nMASE = moy(|e_{T+h}|/Q)\\quad\\text{avec $Q$ une mesure stable de l'échelle de $y_t$}\n$$\n$$\n\\begin{cases}\nQ=\\frac{1}{T-1}\\sum_{t=2}^T|y_{t}-y_{t-1}|&\\text{ série non saisonnière}\\\\\nQ=\\frac{1}{T-m}\\sum_{t=m+1}^T|y_{t}-y_{t-m}|&\\text{ série saisonnière}\n\\end{cases}\n$$\n\n### Validation croisée dans les séries temporelles\n\nPrévisions en temps-réel : prévisions dynamiques en réactualisant les coefficients à chaque date.\n\n\\faArrowCircleRight{} *leave-$h$-out cross-validation*\n\n. . .\n\nOn peut ensuite comparer les erreurs en utilisant un critère (e.g. RMSE) et un test (`forecast::dm.test()`).\n\nExemple LOOCV ($h=1$), modèle trimestriel :\n\n\\medskip\n\\begin{tikzpicture}\n\\onslide<2-3>{\n\\node at (0,0){\n$\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{\\textcolor{green!60!black}{2021T4}} \\\\\n\\hline\n\\end{array}$};\n}\n\\onslide<3>{\n\\node (n1) at (0.2,0){\n$\\left.\\phantom{\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4} \\\\\n\\hline\n\\end{array}}\\right\\}$};\n\\draw[-latex,thick] (n1.east)--++(1,0) node[right]{\\begin{minipage}{8cm} \nOn estime les coefficients sur la période 2000T1-\\textcolor{green!60!black}{2021T4} pour prévoir le point de 2022T1\n\\end{minipage}};\n}\n\n\\onslide<4>{\n\\node at (0,0){\n$\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{\\textcolor{green!60!black}{2022T1}} \\\\\n\\hline\n\\end{array}$};\n\\node (n2) at (0.2,0){\n$\\left.\\phantom{\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{2022T1} \\\\\n\\hline\n\\end{array}}\\right\\}$};\n\\draw[-latex,thick] (n2.east)--++(1,0) node[right]{\\begin{minipage}{8cm} \nOn estime les coefficients sur la période 2000T1-\\textcolor{green!60!black}{2022T1} pour prévoir le point de 2022T2\n\\end{minipage}};\n}\n\n\\onslide<5>{\n\\node at (0,0){\n$\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{2022T1} \\\\\n \\hline \\text{\\textcolor{green!60!black}{2022T2}} \\\\\n\\hline\n\\end{array}$};\n\\node (n3) at (0.2,0){\n$\\left.\\phantom{\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{2022T1} \\\\\n  \\hline \\text{2022T2} \\\\\\hline\n\\end{array}}\\right\\}$};\n\\draw[-latex,thick] (n3.east)--++(1,0) node[right]{\\begin{minipage}{8cm} \nOn estime les coefficients sur la période 2000T1-\\textcolor{green!60!black}{2022T2} pour prévoir le point de 2022T3\n\\end{minipage}};\n}\n\\onslide<6->{\n\\node at (0,0){\n$\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{2022T1} \\\\\n \\hline \\text{2022T2} \\\\\n  \\hline \\text{\\textcolor{green!60!black}{2022T3}} \\\\\n\\hline\n\\end{array}$};\n\\node (n4) at (0.2,0){\n$\\left.\\phantom{\\begin{array}{|c|}\n\\hline\n\\text{2000T1} \\\\\n \\hline \\vdots\\\\\\hline \\text{2021T4}\\\\ \\hline \\text{2022T1} \\\\\n  \\hline \\text{2022T2} \\\\  \\hline \\text{2022T3} \\\\\\hline\n\\end{array}}\\right\\}$};\n\\draw[-latex,thick] (n4.east)--++(1,0) node[right]{\\begin{minipage}{8cm} \nOn estime les coefficients sur la période 2000T1-\\textcolor{green!60!black}{2022T3} pour prévoir le point de 2022T4\n\\end{minipage}};\n}\n\\end{tikzpicture}\n\n. . .\n\nOn peut s'aider de `forecast::tsCV()`\n\n## Critères d'information\n\n### Sélection de modèles\n\nLes modèles sont parfois sélectionnés en utilisant des critères d'information (AIC, BIC, HQ) qui sont des vraisemblances pénalisées. Retenir :\n\n::: incremental\n\n- Il faut les minimiser\n- Ils sont définis à une constante additive/multiplicative près (qui peut changer en fonction des logiciels)\n- AICc effectue une correction lorsqu'il y a peu de données\n- Minimiser l'AIC est asymptotiquement équivalent à minimiser le LOOCV\n- Minimiser le BIC est asymptotiquement équivalent à minimiser le L-$v$-OCV avec $v = T[1-1/(\\log(T)-1)]$ et à sélection le *true model*\n- L'AIC a tendance à sur-ajuster le modèle et le BIC à le sous-ajuster\n- $\\bar R^2$ a tendance à sélectionner trop de variables\n- Ne comparer les modèles avec critères d'information que s'ils sont calculés sur les mêmes données (\\bcattention ordre de différenciation ARIMA et ARIMA vs ETS)\n\n:::\n\n# Conclusion\n\n### Conclusions\n\n- Dans beaucoup de cas les meilleurs modèles de prévision seront les plus simples : dernière valeur, valeur moyenne, valeur de la période précédente, etc.\n\n- Le lissage exponentiel basé sur la description de la tendance et de la saisonnalité de la série\n\n- La sélection d'un modèle peut se faire par un critère d'information ou par minimisation d'une statistique de validation croisée\n\n- Les erreurs de prévision doivent être non corrélés et être de moyenne nulle. Pour la construction d'intervalles de confiance il faut en plus une variance constante et une loi normale\n\n### Bibliographie\n\n\nHyndman, R.J., & Athanasopoulos, G. (2018) *Forecasting: principles and practice*, 2nd edition, OTexts: Melbourne, Australia. OTexts.com/fpp2. Accessed on oct. 2023.\n\nHyndman, R.J., & Athanasopoulos, G. (2021) *Forecasting: principles and practice*, 3rd edition, OTexts: Melbourne, Australia. OTexts.com/fpp3. Accessed on oct. 2023.\n",
    "supporting": [
      "4_Lissage_Exponentiel_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}